
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8" />
        <title>SpringBoot整合Zookeeper简单运用 | 阿杰之家</title>
        <meta name="author" content="ajiehome" />
        <meta name="description" content="山有扶苏，隰有荷华" />
        <meta name="keywords" content="ajiehome,阿杰之家" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <link rel="icon" href="https://static-argvchs.netlify.app/images/favicon.png" />
        <script src="https://static-argvchs.netlify.app/libs/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="preconnect" href="https://static-argvchs.netlify.app" crossorigin />
<link rel="stylesheet" href="https://static-argvchs.netlify.app/libs/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="https://static-argvchs.netlify.app/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://static-argvchs.netlify.app/libs/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://static-argvchs.netlify.app/libs/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://static-argvchs.netlify.app/libs/KaTeX/0.16.4/katex.min.js"></script>
<script src="https://static-argvchs.netlify.app/libs/KaTeX/0.16.4/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://static-argvchs.netlify.app/libs/KaTeX/0.16.4/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<script src="https://static-argvchs.netlify.app/libs/animejs/3.2.1/anime.min.js"></script>
<link rel="stylesheet" href="/css/main.css" />

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
                <div id="loading" v-show="loading">
                    <div id="loading-circle">
                        <h2>LOADING</h2>
                        <p>加载过慢请开启缓存 浏览器默认开启</p>
                        <img src="/images/loading.gif" />
                    </div>
                </div>
            </transition>
            <nav id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <div id="desktop-menu">
        <a class="title" href="/">
            <span>阿杰之家</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;阿杰之家</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </div>
</nav>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

            <transition name="into">
                <div id="main" v-show="!loading">
                    <div class="article">
    <div>
        <h1>SpringBoot整合Zookeeper简单运用</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/6/7
        </span>
        
        <span class="category">
            <a href="/categories/%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                开源框架
            </a>
        </span>
        
        
    </div>
    
    <div class="content" v-pre>
        <hr>
<h2 id="title-SpringBoot整合Zookeeper简单运用date-2022-10-11-10-27-30-04updated-2022-10-13-14-43-42-459url-x2F-archives-x2F-spring-boot-zheng-he-zookeeper-jian-dan-yun-yongcategories-Zookeeper-SpringBoottags-SpringBoot-Zookeeper"><a href="#title-SpringBoot整合Zookeeper简单运用date-2022-10-11-10-27-30-04updated-2022-10-13-14-43-42-459url-x2F-archives-x2F-spring-boot-zheng-he-zookeeper-jian-dan-yun-yongcategories-Zookeeper-SpringBoottags-SpringBoot-Zookeeper" class="headerlink" title="title: SpringBoot整合Zookeeper简单运用date: 2022-10-11 10:27:30.04updated: 2022-10-13 14:43:42.459url: &#x2F;archives&#x2F;spring-boot-zheng-he-zookeeper-jian-dan-yun-yongcategories:- Zookeeper- SpringBoottags:- SpringBoot- Zookeeper"></a>title: SpringBoot整合Zookeeper简单运用<br>date: 2022-10-11 10:27:30.04<br>updated: 2022-10-13 14:43:42.459<br>url: &#x2F;archives&#x2F;spring-boot-zheng-he-zookeeper-jian-dan-yun-yong<br>categories:<br>- Zookeeper<br>- SpringBoot<br>tags:<br>- SpringBoot<br>- Zookeeper</h2><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>zookeeper一般作为注册中心、配置中心等使用，对于此处的使用，spring cloud zookeeper有非常完善的api，引入相对于的pom即可</p>
<p>而在此处是对zookeeper的基础api进行简单的运用，也就是对zookeeper的节点运用，不涉及集群操作</p>
<pre><code class="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;
  &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://zookeeper.apache.org/">详情参照</a></p>
<h2 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h2><p>zookeeper的节点存储为树形结构，并且其存在多种节点类型，这里只简单使用了持久节点和临时节点<br>持久节点为客户端一经创建，则会永久的存在与本地文件系统，除非客户端手动删除<br>临时节点与客户端的本次连接生命周期一致，连接断掉即自动删除节点，也可手动删除</p>
<p>需要注意的是临时节点下不能存在子节点</p>
<h2 id="代码使用"><a href="#代码使用" class="headerlink" title="代码使用"></a>代码使用</h2><p>属性值</p>
<pre><code class="java">/**
 * @author huangJie
 * @version 1.0v
 * @date 2022/10/10 14:57
 */
@Data
@Configuration
@ConfigurationProperties(prefix = PropertiesPrefixConstant.ZK)
public class ZkProperties &#123;
    private String address;
    private Integer timeout;
&#125;
</code></pre>
<p>配置: 此处的bean配置的为客户端的连接，Zookeeper的客户端对象作为单例存在于IOC容器，维持客户端连接</p>
<pre><code class="java">/**
 * @author huangJie
 * @version 1.0v
 * @date 2022/10/10 15:06
 */
@Configuration
@ConditionalOnProperty(prefix = Constant.CONDITIONAL, name = &quot;zk&quot;, havingValue = &quot;true&quot;)
public class ZookeeperConfig &#123;

    private final static Logger LOGGER = LoggerFactory.getLogger(ZookeeperConfig.class);
    @Resource
    private ZkProperties zkProperties;


    public void test()&#123;

    &#125;

    @Bean
    public ZooKeeper zkClient() &#123;
        ZooKeeper zooKeeper = null;
        try &#123;
            final CountDownLatch countDownLatch = new CountDownLatch(1);
            zooKeeper = new ZooKeeper(zkProperties.getAddress(), zkProperties.getTimeout(), new Watcher() &#123;
                @Override
                public void process(WatchedEvent event) &#123;
                    if (Event.KeeperState.SyncConnected == event.getState()) &#123;
                        countDownLatch.countDown();
                    &#125;
                &#125;
            &#125;);
            countDownLatch.await();
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;zk init client for error&quot;, e);
        &#125;
        return zooKeeper;
    &#125;

&#125;
</code></pre>
<p>API提供者</p>
<pre><code class="java">/**
 * @author huangJie
 * @version 1.0v
 * @date 2022/10/10 15:32
 */
@Component
public class ZkProducer &#123;
    private final static Logger LOGGER = LoggerFactory.getLogger(ZkProducer.class);
    @Resource
    private ZooKeeper zkClient;

    /**
     * 创建永久节点
     *
     * @param path 节点路径
     * @param data 节点的数据
     * @return true创建成功 false创建失败
     */
    public boolean createNode(String path, String data) &#123;
        try &#123;
            if (!existsNode(path)) &#123;
                zkClient.create(path, data.getBytes(StandardCharsets
                        .UTF_8), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
            &#125;
            return true;
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;create zk node for error&quot;, e);
        &#125;
        return false;
    &#125;


    /**
     * 创建临时节点
     *
     * @param path 路径
     * @param data 数据
     * @return true创建成功 false创建失败
     */
    public boolean createTmpNode(String path, String data) &#123;
        try &#123;
            if (!existsNode(path)) &#123;
                zkClient.create(path, data.getBytes(StandardCharsets
                        .UTF_8), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);
            &#125;
            return true;
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;create zk tmp node for error&quot;, e);
        &#125;
        return false;
    &#125;

    /**
     * 更新节点数据
     *
     * @param path 节点路径
     * @param data 数据
     * @return true成功 false失败
     */
    public boolean updateNode(String path, String data) &#123;
        try &#123;
            if (existsNode(path)) &#123;
                zkClient.setData(path, data.getBytes(StandardCharsets.UTF_8), -1);
                return true;
            &#125;
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;update for zk node data error&quot;, e);
        &#125;
        return false;
    &#125;

    /**
     * 删除节点
     *
     * @param path 节点路径
     * @return true成功 false失败
     */
    public boolean deleteNode(String path) &#123;
        try &#123;
            if (existsNode(path)) &#123;
                zkClient.delete(path, -1);
            &#125;
            return true;
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;delete for zk node error&quot;, e);
        &#125;
        return false;
    &#125;

    /**
     * 获取子级节点
     *
     * @param path 节点路径
     * @return 子级结果集合
     */
    public List&lt;String&gt; childrenNode(String path) &#123;
        try &#123;
            return zkClient.getChildren(path, true);
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;obtain node child for error&quot;, e);
        &#125;
        return Collections.emptyList();
    &#125;

    /**
     * 获取节点的数据
     *
     * @param path 节点路径
     * @return 数据
     */
    public String dataGet(String path) &#123;
        try &#123;
            if (existsNode(path)) &#123;
                byte[] data = zkClient.getData(path, true, new Stat());
                return new String(data);
            &#125;
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;get zk node on data for error&quot;, e);
        &#125;
        return null;
    &#125;


    /**
     * 判断节点是不是存在
     *
     * @param path zk节点
     * @return true存在 false不存在
     */
    private boolean existsNode(String path) &#123;
        try &#123;
            return zkClient.exists(path, true) != null;
        &#125; catch (Exception e) &#123;
            LOGGER.error(&quot;judge zk node whether exists for error&quot;, e);
        &#125;
        return false;
    &#125;

&#125;
</code></pre>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2023 阿杰之家
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;ajiehome
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

                </div>
            </transition>
            
            <transition name="fade">
                <div id="preview" ref="preview" v-show="previewShow">
                    <img id="preview-content" ref="previewContent" />
                </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        <script>
            console.info("Welcome to Argvchs' blog!");
            if (!window.hasOwnProperty("ontouchstart")) {
                let html = '<canvas id="fireworks" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"></canvas><script src="https://static-argvchs.netlify.app/js/fireworks.min.js"><\/script>';
                document.body.append(document.createRange().createContextualFragment(html));
            }
        </script>
        
        
<script
    src="https://giscus.app/client.js"
    data-repo="argvchs/giscus-comments"
    data-repo-id="R_kgDOI_uC-w"
    data-category="Announcements"
    data-category-id="DIC_kwDOI_uC-84CUToF"
    data-mapping="pathname"
    data-strict="1"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="https://static-argvchs.netlify.app/css/giscus.css"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
